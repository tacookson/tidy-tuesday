---
title: "canadian-wind-turbines"
author: "Alex Cookson"
date: "27/10/2020"
output: html_document
---

```{r setup, warning = FALSE, message = FALSE}
library(tidyverse)
library(sf)
library(ggthemes)
library(gganimate)

wind_turbine <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-10-27/wind-turbine.csv')
```

```{r ontario-shapefile}
ontario_borders <- read_sf("./2020/2020-10-27 (Canadian Wind Turbines)/lpr_000b16a_e/lpr_000b16a_e.shp") %>%
  filter(PRNAME == "Ontario") %>%
  .$geometry
```


```{r clean-data}
ontario_turbines <- wind_turbine %>%
  filter(province_territory == "Ontario") %>%
  group_by(project_name,
           year = parse_number(commissioning_date)) %>%
  summarise(longitude_centroid = mean(longitude),
            latitude_centroid = mean(latitude),
            turbines = n(),
            capacity = mean(total_project_capacity_mw)) %>%
  ungroup()

turbines_sf <- st_as_sf(ontario_turbines,
                        coords = c("longitude_centroid", "latitude_centroid")) %>%
  st_set_crs(4326)
```

```{r}
ggplot() +
  geom_sf(data = ontario_borders,
          fill = "#f7f3e8",
          colour = NA) +
  geom_sf(data = turbines_sf,
          aes(size = capacity),
          shape = 16,
          alpha = 0.8,
          colour = "#4d5b6a",
          fill = "#4d5b6a",
          show.legend = FALSE) +
  coord_sf() +
  theme_map()
```

```{r}
p <- ggplot() +
  geom_sf(data = ontario_borders,
          fill = "#4d5b6a",
          colour = NA) +
  geom_sf(data = turbines_sf,
          aes(group = project_name, size = capacity),
          alpha = 0.8,
          colour = "#f7f3e8",
          show.legend = FALSE) +
  coord_sf() +
  theme_map() +
  transition_time(time = year,
                  range = c(1991, 2019)) +
  shadow_mark() +
  labs(title = "Year: {round(frame_time, 0)}")

animate(p, start_pause = 15, end_pause = 40)
```



